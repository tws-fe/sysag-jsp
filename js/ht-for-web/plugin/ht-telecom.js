!function(q,T){"use strict";var b=ht.AlarmSeverity=function(N,t,W,l,a){this.value=N,this.name=t,this.nickName=W,this.color=l,this.displayName=a};ht.Default.def("ht.AlarmSeverity",T,{toString:function(){return this.displayName||this.name}}),function(){b.severities=new ht.List,b._vm={},b._nm={},b._cp=function(c,V){if(c&&V){var J=c.value-V.value;return J>0?1:0>J?-1:0}return c&&!V?1:!c&&V?-1:0},b.each=function(D,O){b.severities.each(D,O)},b.getSortFunction=function(){return b._cp},b.setSortFunction=function(N){b._cp=N,b.severities.sort(N)},b.add=function(n,v,I,H,f){var D=new b(n,v,I,H,f);return b._vm[n]=D,b._nm[v]=D,b.severities.add(D),b.severities.sort(b._cp),D},b.remove=function(w){var i=b._nm[w];return i&&(delete b._nm[w],delete b._vm[i.value],b.severities.remove(i)),i},b.CRITICAL=b.add(500,"Critical","C","#FF0000"),b.MAJOR=b.add(400,"Major","M","#FFA000"),b.MINOR=b.add(300,"Minor","m","#FFFF00"),b.WARNING=b.add(200,"Warning","W","#00FFFF"),b.INDETERMINATE=b.add(100,"Indeterminate","N","#C800FF"),b.CLEARED=b.add(0,"Cleared","R","#00FF00"),b.isClearedAlarmSeverity=function(q){return q?0===q.value:!1},b.getByName=function(m){return b._nm[m]},b.getByValue=function(Y){return b._vm[Y]},b.clear=function(){b.severities.clear(),b._vm={},b._nm={}},b.compare=function(j,o){return b._cp(j,o)}}();var U=ht.AlarmState=function(W){this._d=W,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",T,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var X=null;for(var q in this._am)q=b.getByName(q),b.isClearedAlarmSeverity(q)||0!==this.getAcknowledgedAlarmCount(q)&&(X=X?b.compare(X,q)>0?X:q:q);this._haa=X},_c2:function(){var g=null;for(var t in this._nm)t=b.getByName(t),b.isClearedAlarmSeverity(t)||0!==this.getNewAlarmCount(t)&&(g=g?b.compare(g,t)>0?g:t:t);this._hna=g},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var D in this._nm)if(D=b.getByName(D),!b.isClearedAlarmSeverity(D)&&0!==this.getNewAlarmCount(D)&&b.compare(this._hna,D)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var $=this._haa,X=this._hna,g=this._ps;this._hoa=$,b.compare(X,this._hoa)>0&&(this._hoa=X),b.compare(g,this._hoa)>0&&(this._hoa=g)},_c5:function(){var p=this._haa,X=this._hna;this._hta=p,b.compare(X,this._hta)>0&&(this._hta=X)},increaseAcknowledgedAlarm:function(o,r){if(0!==r){r=r||1;var F=this._am[o.name]||0;F+=r,this._am[o.name]=F,this._f()}},increaseNewAlarm:function(O,L){if(0!==L){L=L||1;var b=this._nm[O.name]||0;b+=L,this._nm[O.name]=b,this._f()}},decreaseAcknowledgedAlarm:function(i,v){if(0!==v){v||(v=1);var O=this._am[i.name]||0;if(O-=v,0>O)throw"Alarm count can not be negative";this._am[i.name]=O,this._f()}},decreaseNewAlarm:function(a,P){if(0!==P){P||(P=1);var z=this._nm[a.name]||0;if(z-=P,0>z)throw"Alarm count can not be negative";this._nm[a.name]=z,this._f()}},acknowledgeAlarm:function(d){this.decreaseNewAlarm(d,1),this.increaseAcknowledgedAlarm(d,1)},acknowledgeAllAlarms:function(q){if(q){var t=this.getNewAlarmCount(q);this.decreaseNewAlarm(q,t),this.increaseAcknowledgedAlarm(q,t)}else for(var h in this._nm)this.acknowledgeAllAlarms(b.getByName(h))},_c6:function(){this._aac=0;for(var E in this._am)E=b.getByName(E),this._aac+=this.getAcknowledgedAlarmCount(E)},getAcknowledgedAlarmCount:function(c){return c?this._am[c.name]||0:this._aac},getAlarmCount:function(W){return this.getAcknowledgedAlarmCount(W)+this.getNewAlarmCount(W)},_c7:function(){this._nac=0;for(var c in this._nm)this._nac+=this.getNewAlarmCount(b.getByName(c))},getNewAlarmCount:function(O){return O?this._nm[O.name]||0:this._nac},setNewAlarmCount:function(d,y){this._nm[d.name]=y,this._f()},removeAllNewAlarms:function(k){k?delete this._nm[k]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(L,F){this._am[L.name]=F,this._f()},removeAllAcknowledgedAlarms:function(_){_?delete this._am[_.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(G){if(this._ep||(G=null),this._ps!==G){var d=this._ps;this._ps=G,this._f(),this._d.fp("propagateSeverity",d,G)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(i){var x=this._ep;this._ep=i,this._d.fp("enablePropagation",x,i)&&(i||this.setPropagateSeverity(null))}});var _=ht.AlarmStatePropagator=function(V){this._dataModel=V,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",T,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(G){this._enable!==G&&(this._enable=G,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(y){this.propagate(y)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(z){z.data&&this.propagate(z.data)},handleDataPropertyChange:function(c){if("alarmState"===c.property||"enablePropagation"===c.property)this.propagate(c.data);else if("parent"===c.property){var N=c.oldValue;N&&this.propagate(N),this.propagate(c.data)}},propagate:function(F){F&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(F),this._isPropagating=!1)},propagateToTop:function(z){for(this.propagateToParent(null,z);z&&z.getParent();)this.propagateToParent(z,z.getParent()),z=z.getParent()},propagateToParent:function(m,z){var O=null;z.getChildren().each(function(l){var S=l.getAlarmState().getHighestOverallAlarmSeverity();b.compare(S,O)>0&&(O=S)}),z.getAlarmState().setPropagateSeverity(O)}}),ht.AlarmStateStatistics=function(c){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(c)},ht.Default.def("ht.AlarmStateStatistics",T,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(M){var s=this._dataModel;s!==M&&(s&&(s.umd(this.handleDataPropertyChange,this),s.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=M,this.reset(),M.md(this.handleDataPropertyChange,this),M.mm(this.handleDataModelChange,this),this.fp("dataModel",s,M))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(U){"alarmState"===U.property&&(this.increase(U.data),this.fireAlarmStateChange())},handleDataModelChange:function(P){"add"===P.kind?(this.increase(P.data),this.fireAlarmStateChange()):"remove"===P.kind?(this.decrease(P.data),this.fireAlarmStateChange()):"clear"===P.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,b.each(function(w){var M=this.getSumInfo(w);this.sumAcked+=M.ackedCount,this.sumNew+=M.newCount,this.sumTotal+=M.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(t){if(!t)return this.sumNew;var C=this.getSumInfo(t);return C.newCount},getAcknowledgedAlarmCount:function(f){if(!f)return this.sumAcked;var G=this.getSumInfo(f);return G.ackedCount},getTotalAlarmCount:function(Z){if(!Z)return this.sumTotal;var o=this.getSumInfo(Z);return o.totalCount},getSumInfo:function(U){var L=this.severtiyMap[U.name];return L||(L={},L.newCount=0,L.ackedCount=0,L.totalCount=0,this.severtiyMap[U.name]=L),L},decrease:function(h){var K=this.dataMap[h.getId()];K&&(delete this.dataMap[h.getId()],b.each(function(N){var s=K[N.name],z=this.getSumInfo(N);z.newCount=z.newCount-s.newCount,z.ackedCount=z.ackedCount-s.ackedCount,z.totalCount=z.totalCount-s.totalCount},this))},increase:function(K){if(this.decrease(K),!this._filterFunc||this._filterFunc(K)){var T={},L=K.getAlarmState();this.dataMap[K.getId()]=T,b.each(function(s){var J={};J.newCount=L.getNewAlarmCount(s),J.ackedCount=L.getAcknowledgedAlarmCount(s),J.totalCount=L.getAlarmCount(s),T[s.name]=J;var D=this.getSumInfo(s);D.newCount=D.newCount+J.newCount,D.ackedCount=D.ackedCount+J.ackedCount,D.totalCount=D.totalCount+J.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(J){var l=this._filterFunc;this._filterFunc=J,this.reset(),this.firePropertyChange("filterFunc",l,J)},getFilterFunc:function(){return this._filterFunc}});var A=ht.Data.prototype;A.getAlarmState=function(){return this._alarmState||(this._alarmState=new U(this))},A=ht.DataModel.prototype,A.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},A.setEnableAlarmStatePropagator=function(Z){Z!=this.isEnableAlarmStatePropagator()&&(Z?(this._alarmStatePropagator=new _(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},A=ht.graph.GraphView.prototype,A.getNote2=function(y){var f=y.getAlarmState().getHighestNewAlarmSeverity();if(f){var U=y.getAlarmState().getNewAlarmCount(f)+f.nickName;return y.getAlarmState().hasLessSevereNewAlarms()&&(U+="+"),U}return y.s("note2")},A.getNote2Background=function(U){var l=U.getAlarmState().getHighestNewAlarmSeverity();return l?l.color:U.s("note2.background")},A.getBodyColor=function(Q){var q=Q.getAlarmState().getHighestNativeAlarmSeverity();return q?q.color:Q.s("body.color")},A.getBorderColor=function(z){var U=z.getAlarmState().getPropagateSeverity();return U?U.color:z.s("border.color")},A=ht.widget.TreeView.prototype,A.getBorderColor=function(T){var r=T.getAlarmState().getPropagateSeverity();return r?r.color:T.s("border.color")},A.getIcon=function(Z){return Z.getIcon()?"__alarmIcon__":null},A=ht.widget.TreeTableView.prototype,A.getBorderColor=function(O){var S=O.getAlarmState().getPropagateSeverity();return S?S.color:O.s("border.color")},A.getIcon=function(w){return w.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(O){return O.getIcon()}},color:{func:function(E){var R=E.getAlarmState().getHighestNativeAlarmSeverity();return R?R.color:E.s("body.color")}},rect:[0,0,16,16]}]});var e=ht.Style;e["note2.expanded"]=!0,e["note2.color"]="#000"}(this,Object);