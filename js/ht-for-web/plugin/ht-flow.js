!function(Z){"use strict";var v="ht",W=Z[v],F=W.Default,c=Math,H=c.PI,J=2*H,p=c.sin,n=c.cos,A=c.atan2,M=c.sqrt,U=c.max,e=c.floor,i=(c.round,c.ceil),B=c.abs,s=W.Shape,f=W.Edge,y=W.List,w=W.Style,N=W.graph,Y=F.getInternal(),_=Y.ui(),b=null,L="__segmentLengths",D="__lineTotalLength",G="__linePoints",u="__distance0",z="flow.count",S="flow.step",R="flow.element.max",V="flow.element.count",T="flow.element.min",Q="flow.element.space",o="flow.element.autorotate",t="flow.element.background",P="flow.element.shadow.max",O="flow.element.shadow.min",h="flow.element.shadow.begincolor",K="flow.element.shadow.endcolor",k="flow.element.shadow.visible",$="flow.element.image",g="flow",I="prototype",C=function(U){return document.createElement(U)},E=function(g){for(var x=0,C=g.length-1,D=0;C>D;D++){var X=g[D],t=g[D+1],w=t.x-X.x,p=t.y-X.y,I=M(w*w+p*p);x+=I}return x},r=function(H,s){for(var Y=0,q=0,v=0,z=H.length-1,c=0;z>c;c++){var b=H[c],f=H[c+1],h=f.x-b.x,G=f.y-b.y;if(v=M(h*h+G*G),Y+=v,Y>s){Y-=v,q=c;break}}var I=H[q],L=H[q+1],U=A(L.y-I.y,L.x-I.x),m=s-Y,G=p(U)*m,h=n(U)*m;return{x:I.x+h,y:I.y+G}},d=function(D,f,c,S){var X=n(S),F=p(S),E=X*f-F*c,R=F*f+X*c;return D?{x:D.x+E,y:D.y+R}:{x:E,y:R}},x=function(p,N){p[L]=p[D]=p[G]=N[u]=b},X=function(l,K,A,R,v,g){var r,a,z,o,M,y,c,m,G,U,w,k=[];if(B(R)>J&&(R=J),M=i(B(R)/(H/4)),r=R/M,a=-r,z=-A,M>0){y=l+n(A)*v,c=K+p(-A)*g,k.push({x:y,y:c});for(var V=0;M>V;V++)z+=a,o=z-a/2,m=l+n(z)*v,G=K+p(z)*g,U=l+n(o)*(v/n(a/2)),w=K+p(o)*(g/n(a/2)),k.push({x:U,y:w}),k.push({x:m,y:G})}return k},j=function(x){var C,R,K=x._data;if(K instanceof s){if(C=K.getPoints(),R=K.getSegments(),(!R||0===R.size())&&C){R=new W.List([1]);for(var k=1;k<C.size();k++)R.add(2)}}else if(K instanceof f){var v=x._78o;if(v){var N=v.type,b=v.points,M=v.segments,l=v._4O;if(!N||b){var n=v._69o,Z=n.x,j=n.y,H=v._70o,A=H.x,U=H.y;if(N)M?(C=new y({x:Z,y:j}),C.addAll(b),C.add({x:A,y:U}),R=new y(M._as)):(C=new y({x:Z,y:j}),R=new y([1]),b.each(function(t){C.add(t),R.add(2)}),C.add({x:A,y:U}),R.add(2));else if(v.looped){C=new y(X(Z,j,0,J,v.radius,v.radius)),R=new y([1]);for(var k=0;k<(C.size()-1)/2;k++)R.add(3)}else C=new y,v.center?(C.add({x:v.c1.x,y:v.c1.y}),C.add({x:Z,y:j}),C.add({x:A,y:U}),C.add({x:v.c2.x,y:v.c2.y}),R=new y([1,2,2,2])):(C.add({x:Z,y:j}),C.add({x:A,y:U}),R=new y([1,2]))}else if(l)if(C=new y(l.points._as),l.segments)R=new y(l.segments._as);else{R=new y([1]);for(var k=1;k<l.points.size();k++)R.add(2)}}}if(C&&R){for(var B=Y.toPointsArray(C._as,R._as,50),q=B.length,_=[],k=0;q>k;k++){var Q=B[k];Q.length>1&&_.push(B[k])}K.s("flow.reverse")&&(_.reverse(),_.forEach(function(T){T.reverse()}));for(var I=0,V=[],d=_.length,k=0;d>k;k++){var Q=_[k],t=E(Q);I+=t,V.push(t)}if(K[L]=V,K[D]=I,K[G]=_,K instanceof f){var w=F.unionPoint(_),O=w.x+w.width/2,z=w.y+w.height/2;K.$10e={x:O,y:z}}m(x,!0)}},m=function(w,x){var E=w._data,b=E[D],j=E.s(z),W=E.s(S),g=0,c=E[L],l=E.s(R),h=E.s(T),M=E.s(V),d=(l-h)/(M-1),v=[];if(c){if(1===M)v.push(l);else if(2===M)v.push(l),v.push(h);else{if(!(M>2))return;v.push(l);for(var B=M-2;B>0;B--)v.push(h+d*B);v.push(h)}var Z=0,$=0;v.forEach(function(C){M-1>Z&&($+=E.getFlowElementSpace(C)),Z++}),$+=(l+h)/2,g=(b-j*$+$)/j;var r=w[u];for(null==r&&(r=0),x||(r+=W);r>b+$;){var Y=w._overCount;Y?Y++:Y=1,Y>=j&&(Y=null),w._overCount=Y,E.s("flow.autoreverse")?Y?r-=g+$:(r=0,E.s("flow.reverse",!E.s("flow.reverse"))):r-=g+$}w[u]=r}},l=function(N){var K=N.data,z=this.dm();if(K&&"add"===N.kind){var a=z.$3e;a&&K.s(g)&&a.indexOf(K)<0&&a.push(K)}"clear"===N.kind&&(z.$3e=[])},a=function(t){var B=t.property,q=t.data,G=t.newValue,E=this.dm().$3e;if(E&&"s:flow"===B)if(G)E.indexOf(q)<0&&E.push(q);else for(var R=E.length,s=0;R>s;s++)if(E[s]===q){E.splice(s,1);break}},q=function(D,t){for(var C=0,U=t.length,x=0;U>x;x++){var j=t[x];if(C+=j,C>D)return x}return x},vl=function(x){var a=this,v=a._data,l=v[D],N=v[L],E=v[G],k=v.s(z),y=0,f=a[u],t=v.s(R),p=v.s(T),e=v.s(V),K=v.s(O),h=v.s(P),B=v.s(o),X=(h-K)/(e-1),$=(t-p)/(e-1),H=v.getRotation?v.getRotation():0,c=v.getPosition?v.p():v.$10e,F=[],j=[];if(f!=b){if(1===e)F.push(t);else if(2===e)F.push(t),F.push(p);else{if(!(e>2))return;F.push(t);for(var _=e-2;_>0;_--)F.push(p+$*_);F.push(p)}if(1===e)j.push(h);else if(2===e)j.push(h),j.push(K);else{if(!(e>2))return;j.push(h);for(var _=e-2;_>0;_--)j.push(K+X*_);j.push(K)}var m=0,i=0;F.forEach(function(Q){e-1>m&&(i+=v.getFlowElementSpace(Q)),m++}),i+=(t+p)/2,y=(l-k*i+i)/k,x.save();for(var _=0;k>_;_++){var w=f,n=0,Z=a._overCount,I=0;v.s("flow.autoreverse")&&Z&&Z>k-(_+1)||(w-=_*(y+i),m=0,F.forEach(function(R){var t=w-n;if(t>=0&&l>t){var S=!0,z=q(t,N);I=0;for(var Y=0;z>Y;Y++)I+=N[Y];if(t-=I,S){var J=r(E[z],t),D=H;if(B){for(var W=E[z],f=0,U=0,u=0;u<W.length-1;u++){var h=W[u],b=W[u+1],$=b.x-h.x,G=b.y-h.y,i=M($*$+G*G);if(f+=i,f>t){U=u;break}}var o=W[U];D+=A(J.y-o.y,J.x-o.x)}H&&(J=d(c,J.x-c.x,J.y-c.y,H)),a.$5e(x,J,R,j[m],D)}}n+=v.getFlowElementSpace(F[m]),m++}))}x.restore()}},Xg=N.GraphView[I],wf=W.Data[I],Ke=_.DataUI[I],dn=_.ShapeUI[I],xm=_.EdgeUI[I],Mm=W.DataModel[I],Fo=dn._80o,dc=xm._80o,hh=Mm.prepareRemove,pm=xm._79o,gn=dn._79o,Gb=Xg.setDataModel,Tb=function(){var s=this,m=s._data,$=m.s(R),c=!1,K=b;if(s._6I||(c=!0),K=m instanceof f?pm.call(s):gn.call(s),m.s(g)&&c){var q=m.s(P),O=m.s(k);O&&q>$&&($=q),$>0&&F.grow(K,i($/2)),j(s)}return!m.s(g)&&c&&x(m,s),K};wf.getFlowElementSpace=function(){return this.s(Q)},dn._79o=Tb,xm._79o=Tb,w[R]==b&&(w[R]=7),w[T]==b&&(w[T]=0),w[z]==b&&(w[z]=1),w[S]==b&&(w[S]=3),w[V]==b&&(w[V]=10),w[Q]==b&&(w[Q]=3.5),w[o]==b&&(w[o]=!1),w[t]==b&&(w[t]="rgba(255, 255, 114, 0.4)"),w[h]==b&&(w[h]="rgba(255, 255, 0, 0.3)"),w[K]==b&&(w[K]="rgba(255, 255, 0, 0)"),w[k]==b&&(w[k]=1),w[P]==b&&(w[P]=22),w[O]==b&&(w[O]=4),Mm.prepareRemove=function(o){hh.call(this,o);var b=o._dataModel,d=b.$3e;if(d)for(var c=d.length,q=0;c>q;q++)if(d[q]===o){d.splice(q,1);break}},Xg.setDataModel=function(T){var v=this,C=v._dataModel;if(C!==T){C&&(C.umm(l,v),C.umd(a,v),C.$3e=[]),T.mm(l,v),T.md(a,v);var I=T.$3e=[];T.each(function(d){d.s(g)&&I.indexOf(d)<0&&I.push(d)}),Gb.call(v,T)}},Xg.setFlowInterval=function(l){var v=this,L=v.$11e;v.$11e=l,v.fp("flowInterval",L,l),v.$7e!=b&&(clearInterval(v.$7e),delete v.$7e,v.enableFlow(l))},Xg.getFlowInterval=function(){return this.$11e},Xg.$9e=function(){var b,X,E,T=this,v=T.tx(),g=T.ty(),p=T.getZoom(),C=T.getWidth(),u=T.getHeight(),A={x:-v/p,y:-g/p,width:C/p,height:u/p},q=T.dm().$3e,w=T._56I,G=new y;if(q.forEach(function(l){w[l.getId()]&&(b=T.getDataUI(l),b&&(E=b._79o(),E&&G.add(E)))}),0!==G.size()&&(G.each(function(V){F.intersectsRect(A,V)&&(X=F.unionRect(X,V))}),X&&(X&&(F.grow(X,U(1,1/p)),X.x=e(X.x*p)/p,X.y=e(X.y*p)/p,X.width=i(X.width*p)/p,X.height=i(X.height*p)/p,X=F.intersection(A,X)),X))){var o=T._canvas.getContext("2d");o.save(),o.lineCap=F.lineCap,o.lineJoin=F.lineJoin,Y.translateAndScale(o,v,g,p),o.beginPath(),o.rect(X.x,X.y,X.width,X.height),o.clip(),o.clearRect(X.x,X.y,X.width,X.height),T.$6e(o,X),o.restore()}},Xg.$6e=function(S,L){var b,z,a=this;a._93db(S),a.each(function(E){a._56I[E._id]&&(b=a.getDataUI(E),b&&(z=b._79o(),(!L||F.intersectsRect(L,z))&&b._42(S)))}),a._92db(S)},Xg.enableFlow=function(s){var N=this,w=N.dm(),o=w.$3e;N.$7e==b&&(o.forEach(function(v){var U=N.getDataUI(v);j(U)}),N.$7e=setInterval(function(){o.forEach(function(H){m(N.getDataUI(H))}),N.$9e()},s||N.$11e||50))},Xg.disableFlow=function(){var I=this;clearInterval(I.$7e),delete I.$7e;var G=I.dm().$3e;G&&I.$9e()},Ke.$5e=function(A,j,x,B,O){var U=this,G=U._data,D=U.gv,V=G.s(t),s=G.s(h),y=G.s(K),n=G.s(k),I=D.$8e,R=G.s($);if(I==b&&(I=D.$8e={}),A.beginPath(),R!=b){var Z=F.getImage(R),o=x/2;A.translate(j.x,j.y),A.rotate(O),A.translate(-j.x,-j.y),F.drawImage(A,Z,j.x-o,j.y-o,x,x,G),A.translate(j.x,j.y),A.rotate(-O),A.translate(-j.x,-j.y)}else A.fillStyle=V,A.arc(j.x,j.y,x/2,0,J,!0),A.fill();if(n){var Q=22,z=Q+"_"+s+"_"+y,W=I[z];if(W==b){var a=C("canvas");Y.setCanvas(a,Q,Q);var X=a.getContext("2d"),L=Q/2,p=L,e=L;Y.translateAndScale(X,0,0,1),X.beginPath();var v=X.createRadialGradient(p,e,0,p,p,L);v.addColorStop(0,s),v.addColorStop(1,y),X.fillStyle=v,X.arc(p,e,L,0,J,!0),X.fill(),W=I[z]=a}var o=B/2;F.drawImage(A,W,j.x-o,j.y-o,B,B,G)}},xm._80o=function(a){dc.call(this,a);var d=this,q=d._data,B=d.gv;q.s(g)&&B.$7e!=b&&vl.call(d,a)},dn._80o=function(V){Fo.call(this,V);var l=this,h=l._data,R=l.gv;h.s(g)&&R.$7e!=b&&vl.call(l,V)}}(this,Object);