!function(w,B){"use strict";var U="ht",O=w[U],X=O.Default,u=X.def,R="add",Z="remove",h=X.getInternal(),a="propertyChange";O.HistoryManager=function(B){this._histories=[],this.setDataModel(B)},u(O.HistoryManager,B,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var A=this;A.$4p++,1===A.$4p&&(A.$3p=[])},endInteraction:function(){var L=this,i=L._histories,e=L._historyIndex,j=L.$3p;L.$4p--,0===L.$4p&&(delete L.$3p,j.length&&(i=i.slice(0,e+1),i.push(j),i.length>L._maxHistoryCount&&(i=i.slice(i.length-L._maxHistoryCount)),L.setHistories(i),L.setHistoryIndex(i.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(M){var B=this,X=B._dataModel;X!==M&&(X&&(delete X._historyManager,X.umm(B.$5p,B),X.umd(B.$6p,B)),B._dataModel=M,M._historyManager=B,M.mm(B.$5p,B),M.md(B.$6p,B),B.fp("dataModel",X,M),B.clear())},setHistoryIndex:function(Q,i){var g=this,m=g._historyIndex,h=g._histories.length;if(-1>Q?Q=-1:Q>=h&&(Q=h-1),m!==Q){if(!i){var a=Q-m;a>0?g.$2p(a):0>a&&g.$1p(-a)}g._historyIndex=Q,g.fp("historyIndex",m,Q)}},setMaxHistoryCount:function(w){var s=this,F=s._histories,C=s._maxHistoryCount;(!w||0>=w)&&(w=10),C!==w&&(s._maxHistoryCount=w,s.fp("maxHistoryCount",C,w),F.length>w&&s.clear())},$5p:function(L){if(!this.$7p&&!this.$8p){var k,p,A=this,s=A._histories,O=L.kind,E=L.property,X=A._historyIndex;if(O===R||O===Z?p={type:L.kind,data:L.data}:E&&"children"!==E&&"attaches"!==E&&"shape"!==E&&(p={type:a,data:L.data,property:E,oldValue:L.oldValue,newValue:L.newValue}),p)if(A.$4p){k=A.$3p;var Y=!1;if(p.type===a)for(var q=k.length-1;q>=0;q--){var I=k[q];if(I.type!==a)break;p.property===I.property&&I.property&&p.data===I.data&&(p.oldValue=I.oldValue,k[q]=p,Y=!0)}Y||k.push(p)}else k=[p],s=s.slice(0,X+1),s.push(k),s.length>A._maxHistoryCount&&(s=s.slice(s.length-A._maxHistoryCount)),A.setHistories(s),A.setHistoryIndex(s.length-1,!0)}},$6p:function(P){this.$5p(P)},undo:function(A){(!A||0>=A)&&(A=1),this.setHistoryIndex(this._historyIndex-A)},$1p:function(E){var v,T=this,j=T._dataModel,$=T._histories,f=T._historyIndex;for(T.$7p=1,X.setIsolating(!0);E>0;){if(f>=0&&f<$.length){v=$[f],f--;for(var K=v.length-1;K>=0;K--){var t=v[K],q=t.type,U=t.data,_=t.property,B=t.oldValue;if(q===R)j.remove(U);else if(q===Z)j.add(U);else{var r=null;0===_.indexOf("a:")?(r="attr",_=_.replace("a:","")):0===_.indexOf("s:")&&(r="style",_=_.replace("s:","")),h.setPropertyValue(U,r,_,B)}}}E--}X.setIsolating(!1),delete T.$7p},redo:function($){(!$||0>=$)&&($=1),this.setHistoryIndex(this._historyIndex+$)},$2p:function(T){var i,M=this,c=M._dataModel,p=M._histories,J=M._historyIndex;for(M.$7p=1,X.setIsolating(!0);T>0;){if(J>=-1&&J<p.length-1){J++,i=p[J];for(var t=0;t<i.length;t++){var o=i[t],k=o.type,D=o.data,w=o.property,F=o.newValue;if(k===R)c.add(D);else if(k===Z)c.remove(D);else{var x=null;0===w.indexOf("a:")?(x="attr",w=w.replace("a:","")):0===w.indexOf("s:")&&(x="style",w=w.replace("s:","")),h.setPropertyValue(D,x,w,F)}}}T--}X.setIsolating(!1),delete M.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}(this,Object);